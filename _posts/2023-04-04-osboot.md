---
title: 基于x86处理器的OS内核启动
date: 2023-04-04
description: 
categories: 
  - OS
  - x86汇编
image: https://s1.ax1x.com/2023/03/12/ppM1bX4.jpg
---

&emsp;&emsp; 本文是对操作系统实验课中的OS内核启动过程部分进行梳理和笔记。实际上计算机开机启动确实是个很有趣的过程。可以设想一下，计算机的启动需要程序来加载，但是计算机没有启动又运行不了程序，这有点像是陷进了先有鸡还是先有蛋的问题。

&emsp;&emsp; 那么计算机到底是如何启动的呢？上述那个先有鸡还是先有蛋的问题最终的解决方案是通过一组固化到主板上的ROM来加载能够启动计算机的程序，并最终完成计算机的启动。现代计算机的启动过程如下图所示：

![iamge](https://s1.ax1x.com/2023/04/04/pp4HD8e.png)

&emsp;&emsp; 上图中，在 **BIOS** 之后的所有程序都是存放在硬盘中，他们需要被分别加载到内存中，才能够被CPU执行。而BIOS会为我们自动加载硬盘中的首个扇区（一个扇区一般是512字节）的内容到内存中执行，这个存放在首扇区的程序就叫做MBR。

&emsp;&emsp; **MBR** 的大小被限制为512字节，能做的事情非常有限。所以这个程序中所做的事情主要是进一步把硬盘中的Bootloader程序加载到内存中并跳转到该程序，

&emsp;&emsp; **Bootloader** 程序则没有大小限制，所以可以做很多初始化工作，并把操作系统的内核（kernel）从硬盘中加载到内存中并跳转到内核程序开始运行。

&emsp;&emsp; **Kernel** 加载完毕。自此，计算机完成了启动，我们可以通过操作系统来控制这台电脑了。（顺带一提，没有操作系统的电脑称为裸机，只是由一堆硬件组成，我们没办法和他进行交互）

&emsp;&emsp; 


```s
%include "boot.inc"

[bits 16]
xor ax, ax ; eax = 0
; 初始化段寄存器, 段地址全部设为0
mov ds, ax
mov ss, ax
mov es, ax
mov fs, ax
mov gs, ax

; 初始化栈指针
mov sp, 0x7c00    
```
